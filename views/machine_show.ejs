<% include partials/header %>
<div class="container">
  <div class="jumbotron">
    <div class="container">
      <a href="/employees/" class="btn btn-default btn-lg"
        ><i class="fas fa-arrow-circle-left"></i> Go Back</a
      >
      <img
        align="right"
        src="https://digistorm-websites.s3-ap-southeast-2.amazonaws.com/cac-au-qld-27-website/content/Imported/Monash_Uni_Logo.jpg?mtime=20180928141803"
        class="img-rounded"
        width="250px"
        height="75px"
      />
    </div>

    <h1>Machine Status</h1>
    <div = class="row">
    <div class="col-lg-4">
      <img
        src="https://i.imgur.com/PjXujqt.jpg"
        class="img-rounded"
        width="90%"
        height="90%"
      />
    </div>
    <div class="col-lg-6" id="profile_details">
      <p>
        <b>Name:</b>
        <span>xxxx</span>
      </p>
      <p><b>Employee ID:</b> <span>xxx</span></p>
      <p><b>Department:</b> <span>xx</span></p>
      <p><b>Position:</b> <span>xxx</span></p>
      <p><b>Base Salary:</b> <span>RM xxxx</span></p>
    </div>

    <div class="row"></div>
    <div class="col-lg-6">
      <canvas id="progressChart" width="50%" height="50%"></canvas>

      <!-- <form id="volt-form" action="/machines" method="POST">
        <input id="1" type="text" placeholder="" name="volt" />
        <button type="submit" class="btn btn-primary">Submit</button>
      </form> -->

      <script>

      var voltArray = [<%= voltArray %>] //the [] is removed by default, so we have to add it back
      console.log(voltArray)
        
      

        var months = ['Feb', 'March', 'April', 'May'];
        var averagePerformance = [80, 75, 89, 99];

        machineData = {
          type: 'line',
          data: {
            labels: months,
            datasets: [
              {
                label: 'Employee Performance',
                backgroundColor: 'rgba(121, 61, 244, 0.5)',
                data: averagePerformance
              }
            ]
          },
          options: {
            title: {
              display: true,
              text: 'Machine 1 Monthly Average Performance',
              fontSize: 15
            },
            scales: {
              yAxes: [
                {
                  ticks: {
                    beginAtZero: true
                  }
                }
              ]
            }
          }
        };

        // METHODS
        function addData(chart, label, data) {
          chart.data.labels.push(label);
          chart.data.datasets.forEach(dataset => {
            dataset.data.push(data);
          });
          chart.update();
        }

        function removeData(chart) {
          chart.data.labels.pop();
          chart.data.datasets.forEach(dataset => {
            dataset.data.pop();
          });
          chart.update();
        }

        // Draw initial graph
        var ctx = document.getElementById('progressChart').getContext('2d');
        let progressChart = new Chart(ctx, machineData);
        voltArray.forEach((data) => {
          addData(progressChart, 'June', data);
        })
        
        // Enable pusher logging - don't include this in production
        Pusher.logToConsole = true;

        // Dynamic update
        var pusher = new Pusher('5ed5a1f25586a0760edb', {
          cluster: 'ap1',
          forceTLS: true
        });
        // Dynamic Update
        var channel = pusher.subscribe('machine-1-channel');
        channel.bind('machine-1-sync', function(data) {
          addData(progressChart, 'June', data.volt);
        });

      </script>
    </div>
  </div>
</div>
